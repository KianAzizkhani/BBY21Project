<!DOCTYPE html>
<html lang="en">

<head>

    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <title>Budgeting APP</title>

    <!-- Bootstrap core CSS -->
    <link href="/docs/5.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!--Style sheet-->
    <link rel="stylesheet" href="style.css">

    <!--Google Icons-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
     <!-- Bootstrap FirebaseUI CSS -->


 <!-- Firebase 8 CDNs-->
 <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
 <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
 <script src="https://www.gstatic.com/firebasejs/ui/4.8.1/firebase-ui-auth.js"></script>
 <!--Firebase API-->
<script src="./scripts/firebaseAPI.js"></script>

    <style>

        input {
            font-size: 60%;
            height: 60%;
        }

        select {
            font-size: 90%;
        }

        input {
            font-size: 150%;
        }
        Button {
            text-align: center;
        }

    </style>

</head>

<body>
    <div id="topbar">
        <img src="images/mainpage.png" width="15%" />
        <a style="color: black; float: right;" href="main.html" class="material-icons goRight">home</a>
    </div>
    <h1>Spending Goals</h1>
    <br>
    <br>
    <h2>Enter Goal amount: <input type="text" id="Goal" placeholder="$0.00"></h2>
    <br>
    <h2>What category is your goal?
        <select id="Category" onchange="update()">
			<option value="Food">House</option>
			<option value="Clothes">Clothes</option>
			<option value="Entertainment">Entertainment</option>
		</select>

    </h2>
    <br>
    <button type="submit" style="margin:auto; display:block;" class="btn btn-primary" id="submitButton" onclick="addGoal()">Submit</button>
    <br>
    <br>

    <table id="tabledata">
        <tr id="template">
            <td>
                <h4 id="Category-goes-here">Previous Category: </h4>
                <h4 id="goal-goes-here">Previous Goal: </h4>
            </td>
        </tr>
    </table>

    <div class="fixed-bottom py-3">
        <footer class="navbar justify-content-evenly bg-white fixed-bottom">
            <a href= "categories.html" class="material-icons">category</a>
            <a href="reports.html" class="material-icons">bar_chart</a>
            <a href="add.html" class="material-icons big">add_circle</a>
            <a href="goals.html" class="material-icons">outlined_flag</a>
            <a href="profile.html" class="material-icons">person</a>
        </footer>
    </div>


</body>
<script>
    var userID;
    function addGoal() {
            let Goal = document.getElementById("Goal").value;
            let Category = document.getElementById("Category").value;

            firebase.auth().onAuthStateChanged(user => {
                if (user) {
                    console.log("user is signed in, I'm adding a goal.")
                    var currentUser = db.collection("users").doc(user.uid).collection("Goal");
                    userID = user.uid;

                    currentUser.add({
                        Goal: Goal,
                        Category: Category,
                        // date: automatic
                    });
                    read_display_goal();
                } else {
                    console.log("no user signed in");
                }
            });
        }

        function read_display_goal(){
            console.log(db.collection("users"))
            console.log(doc.data().Goal);
            var UserID = user.uid;
            var currentUser = db.collection("users").doc(userID).collection("Goal")
                .onSnapshot(GoalDoc=>{
                    addGoalRow(GoalDoc.docs);
                    GoalDoc.docs.forEach(doc => {
                        document.getElementById("goal-goes-here").innerText = doc.data().Goal;
                        document.getElementById("Category-goes-here").innerText = doc.data().Category;

                    });
                    //console.log(GoalDoc.docs);
                    //console.log(GoalDoc.data().Goal);

                    //console.log("Goal received");
                })
        }
        // function addGoalRow(doc) {
        //     let template = document.getElementById("template");
        //     let container = document.getElementById("tabledata");
        //     //console.log(Docs.size);

        //     let newRow = template.cloneNode(true);


        //     newRow.querySelector('#goal-goes-here').innerHTML = doc.data().Goal;

        //     container.appendChild(newRow);
        // }

        function addGoalRow(docs) {
            let template = document.getElementById("template");
            let container = document.getElementById("tabledata");

            while (container.firstChild){
                container.removeChild(container.firstChild);
            }

            docs.forEach(doc => {

                let newRow = template.cloneNode(true);

                newRow.querySelector('#goal-goes-here').innerHTML = doc.data().Goal;
                newRow.querySelector('#Category-goes-here').innerHTML = doc.data().Category;
                container.appendChild(newRow);

            })
        }



    //     function buildHTML(results){
    // //reads card.html template
    // let card = fs.readFileSync("./1800/BB21Project/Card.html", "utf8");
    //     let cardDOM = new JSDOM(card);
    // let html="";
    // //loops through the database and prints
    //     results.forEach((result) => {
    //         //injecting variables into card DOM
    //         cardDOM.window.document.getElementById("Amount").innerHTML
    //         = user.Amount;
    //         //converts card DOM into html
    //         html += cardDOM.serialize();
    //     });
    // return html;

    //}
</script>

</html>